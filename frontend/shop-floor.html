<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Floor Productivity Display</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: white;
            overflow: hidden;
            height: 100vh;
        }
        
        /* Animated Background */
        .bg-animation {
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Floating particles */
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: float-up 15s infinite;
        }
        
        @keyframes float-up {
            0% {
                opacity: 0;
                transform: translateY(100vh) scale(0);
            }
            10% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100vh) translateX(100px) scale(0);
            }
        }
        
        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header h1 {
            font-size: 3.5em;
            font-weight: 700;
            margin: 0;
            background: linear-gradient(45deg, #00ff88, #00ddff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 2s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }
        
        .datetime {
            font-size: 1.5em;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 10px;
        }
        
        /* Main Layout */
        .main-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            padding: 30px;
            height: calc(100vh - 120px);
        }
        
        /* Leaderboard */
        .leaderboard {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: scroll;
        }
        
        .leaderboard h2 {
            font-size: 2em;
            margin-bottom: 30px;
            text-align: center;
            color: #00ff88;
        }
        
        /* Employee Cards */
        .employee-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .employee-card:hover {
            transform: translateX(10px);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }
        
        /* Rank styling */
        .rank {
            font-size: 2.5em;
            font-weight: bold;
            width: 80px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .rank-1 { 
            color: #FFD700;
            text-shadow: 0 0 20px #FFD700;
            font-size: 3em;
        }
        .rank-2 { 
            color: #C0C0C0;
            text-shadow: 0 0 20px #C0C0C0;
        }
        .rank-3 { 
            color: #CD7F32;
            text-shadow: 0 0 20px #CD7F32;
        }
        
        .employee-info {
            flex: 1;
            margin-left: 20px;
        }
        
        .employee-name {
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .employee-stats {
            display: flex;
            gap: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1em;
        }
        
        .employee-score {
            font-size: 3em;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Progress bar */
        .progress-bar-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00ddff);
            animation: progress-glow 2s ease-in-out infinite;
        }
        
        @keyframes progress-glow {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        /* Stats Panel */
        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: scale(1.02);
            border-color: rgba(0, 255, 136, 0.5);
        }
        
        .stat-value {
            font-size: 3.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 1.2em;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Color coding for stats */
        .stat-good { color: #00ff88; }
        .stat-warning { color: #ffd700; }
        .stat-info { color: #00ddff; }
        
        /* Team goal progress */
        .goal-progress {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .goal-progress h3 {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #00ff88;
        }
        
        .circular-progress {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }
        
        .circular-progress svg {
            transform: rotate(-90deg);
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            font-weight: bold;
        }
        
        /* Achievement ticker */
        .achievement-ticker {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 255, 136, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-top: 1px solid rgba(0, 255, 136, 0.3);
            overflow: hidden;
        }
        
        .ticker-content {
            display: flex;
            animation: scroll 50s linear infinite;
            gap: 100px;
        }
        
        .achievement-item {
            display: flex;
            align-items: center;
            font-size: 1.3em;
            white-space: nowrap;
        }
        
        .achievement-icon {
            font-size: 1.5em;
            margin-right: 10px;
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 1400px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            .stats-container {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
            }
            /* Scrollable leaderboard */
        .leaderboard-list {
            max-height: calc(100vh - 400px);
            overflow-y: scroll;
            overflow-x: hidden;
            padding-right: 10px;
        }

        /* Custom scrollbar for leaderboard */
        .leaderboard-list::-webkit-scrollbar {
            width: 8px;
        }

        .leaderboard-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .leaderboard-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .leaderboard-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        .employee-info {
            flex: 1;
            margin-left: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .employee-roles {
            margin-top: 5px;
            font-size: 0.95em;
            color: rgba(255, 255, 255, 0.7);
        }

        .employee-stats {
            display: flex;
            gap: 15px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1em;
            flex-wrap: wrap;
        }

        .employee-stats span {
            white-space: nowrap;
        }

        .employee-badge {
            margin-top: 5px;
            font-size: 0.85em;
            color: #00ff88;
        }
        /* Ticker animation */
        @keyframes scroll {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }

        .ticker-content {
            display: flex;
            white-space: nowrap;
        }

        .ticker-content.animate-scroll {
            animation: scroll 30s linear infinite;
        }

        /* Update streak item to show items */
        .streak-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .streak-name {
            font-size: 1.2em;
            font-weight: 600;
        }

        .streak-items {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.7);
        }
        }
/* Mobile responsive styles */
@media (max-width: 768px) {
    * { font-size: 10px !important;     .running-ticker { display: none !important; }
}
    .container { padding: 5px !important; }
    h1, h2, h3 { font-size: 14px !important; }
    .employee-name { font-size: 11px !important; }
    .points { font-size: 12px !important; }
    body { font-size: 12px !important; }
    .header h1 { font-size: 1.5rem !important; }
    .dashboard-grid { grid-template-columns: 1fr !important; }
    .leaderboard-item { padding: 5px !important; font-size: 0.8rem !important; }
    .stat-card, .employee-card { padding: 8px !important; }
    .main-container { height: auto !important; overflow-y: scroll !important; }
}
/* Mobile Scrolling Fix */
@media only screen and (max-width: 768px) {
    body {
        overflow: auto !important;
        overflow-x: hidden !important;
        height: auto !important;
    }
    .main-container {
        height: auto !important;
        overflow: visible !important;
    }
    .achievement-ticker {
        position: relative !important;
    }
}
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation" id="bgAnimation"></div>
    
    <!-- Header -->
    <div class="header">
        <h1>🏆 PRODUCTIVITY CHAMPIONS 🏆</h1>
        <div class="datetime" id="datetime"></div>
    </div>
    
    <!-- Main Container -->
    <div class="main-container">
        <!-- Leaderboard Section -->
        <div class="leaderboard">
            <h2>🌟 Today's Leaders 🌟</h2>
            <div id="leaderboardContent">
                <!-- Top 3 with special styling -->
                <!-- Static data replaced with dynamic loading -->
                
                <div class="employee-card">
                    <div class="rank rank-2">🥈</div>
                    <div class="employee-info">
                        <div class="employee-name">John Chen</div>
                        <div class="employee-stats">
                            <span>🎯 Picker</span>
                            <span>⚡ 15 items/min</span>
                            <span>⭐ Rising Star</span>
                        </div>
                    </div>
                    <div class="employee-score">487</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: 93%"></div>
                    </div>
                </div>
                
                <div class="employee-card">
                    <div class="rank rank-3">🥉</div>
                    <div class="employee-info">
                        <div class="employee-name">Sarah Williams</div>
                        <div class="employee-stats">
                            <span>🔥 Heat Press</span>
                            <span>⚡ 12 items/min</span>
                            <span>💎 Veteran</span>
                        </div>
                    </div>
                    <div class="employee-score">445</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: 85%"></div>
                    </div>
                </div>
                
                <!-- Rest of top 10 -->
                <div class="employee-card">
                    <div class="rank">4</div>
                    <div class="employee-info">
                        <div class="employee-name">Mike Johnson</div>
                        <div class="employee-stats">
                            <span>🏷️ Labeler</span>
                            <span>⚡ 14 items/min</span>
                        </div>
                    </div>
                    <div class="employee-score">412</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: 79%"></div>
                    </div>
                </div>
                
                <div class="employee-card">
                    <div class="rank">5</div>
                    <div class="employee-info">
                        <div class="employee-name">Lisa Park</div>
                        <div class="employee-stats">
                            <span>📦 Packing</span>
                            <span>⚡ 13 items/min</span>
                        </div>
                    </div>
                    <div class="employee-score">398</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: 76%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Stats Section -->
        <div class="stats-container">
            <!-- Team Goal Progress -->
            <div class="goal-progress">
                <h3>Daily Team Goal</h3>
                <div class="circular-progress">
                    <svg width="200" height="200">
                        <circle cx="100" cy="100" r="90" stroke="rgba(255,255,255,0.1)" stroke-width="15" fill="none"/>
                        <circle cx="100" cy="100" r="90" stroke="url(#gradient)" stroke-width="15" fill="none"
                                stroke-dasharray="565.48" stroke-dashoffset="113" stroke-linecap="round"/>
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#00ff88"/>
                                <stop offset="100%" stop-color="#00ddff"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <div class="progress-text stat-good">82%</div>
                </div>
                <div class="text-center mt-3">
                    <div class="stat-label">16,432 / 20,000 items</div>
                </div>
            </div>
            
            <!-- Stats Cards -->
            <div class="stat-card">
                <div class="stat-value stat-info">27</div>
                <div class="stat-label">Active Team Members</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value stat-good">⬆ 15%</div>
                <div class="stat-label">vs Yesterday</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value stat-warning">3:42</div>
                <div class="stat-label">Hours to Goal</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value">🔥🔥🔥</div>
                <div class="stat-label">Team is ON FIRE!</div>
            </div>
        </div>
    </div>
    
    <!-- Achievement Ticker -->
    <div class="achievement-ticker">
        <div class="ticker-content">
            <div class="achievement-item">
                <span class="achievement-icon">🎯</span>
                <span>Carlos just earned "Speed Demon" badge for 20 items/minute!</span>
            </div>
            <div class="achievement-item">
                <span class="achievement-icon">🏆</span>
                <span>Packing team reached 5,000 items - New Record!</span>
            </div>
            <div class="achievement-item">
                <span class="achievement-icon">⭐</span>
                <span>Amy achieved perfect efficiency for 2 hours straight!</span>
            </div>
            <div class="achievement-item">
                <span class="achievement-icon">💪</span>
                <span>Heat Press team is 25% above target!</span>
            </div>
            <div class="achievement-item">
                <span class="achievement-icon">🎉</span>
                <span>New monthly record: 450,000 items processed!</span>
            </div>
        </div>
    </div>
    
    <script>
        // Create floating particles
        function createParticles() {
            const bg = document.getElementById('bgAnimation');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = Math.random() * 20 + 15 + 's';
                bg.appendChild(particle);
            }
        }
        
        // Update datetime
        function updateDateTime() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            document.getElementById('datetime').textContent = now.toLocaleDateString('en-US', options);
        }
        
        // Simulate data updates
        // function updateLeaderboard_OLD() {
            // This would fetch from your API
            console.log('Updating leaderboard...');
            
            // Add animation to new scores
            const scores = document.querySelectorAll('.employee-score');
            scores.forEach(score => {
                if (Math.random() > 0.7) {
                    score.style.transform = 'scale(1.2)';
                    setTimeout(() => {
                        score.style.transform = 'scale(1)';
                    }, 500);
                }
            });
        }
        
        // Initialize
        createParticles();
        updateDateTime();
        setInterval(updateDateTime, 1000);
        // DISABLED: setInterval(updateLeaderboard, 5000); // Update every 5 seconds
        
        // Add some random animations
        document.querySelectorAll('.employee-card').forEach((card, index) => {
            card.style.animationDelay = index * 0.1 + 's';
        });
        
        // Circular progress animation
        function animateCircularProgress(targetPercent) {
            const circle = document.querySelector('.circular-progress circle:last-child');
            const circumference = 2 * Math.PI * 90;
            const offset = circumference - (targetPercent / 100) * circumference;
            circle.style.strokeDashoffset = offset;
        }
        
    // Animate on load
        setTimeout(() => animateCircularProgress(82), 500);
    </script>
    <script src="dashboard-api.js"></script>
    <script>
    // Initialize the Shop Floor Display with real data
    document.addEventListener('DOMContentLoaded', () => {
        const display = new ShopFloorDisplay();
        display.init();
        
        // Clean up on page unload
        window.addEventListener('beforeunload', () => display.destroy());
    });
    </script>

    <script>
        // Dynamic Shop Floor Updater
        const shopFloorUpdater = {
            api: null,
            updateInterval: null,
            
            init() {
                this.api = new ProductivityAPI();
                this.loadLeaderboard();
                // Refresh every 30 seconds
                this.updateInterval = // DISABLED: setInterval(() => this.loadLeaderboard(), 30000);
            },
            
            async loadLeaderboard() {
                try {
                    const today = this.api.getCentralDate();
                    const leaderboard = await this.api.getLeaderboard(today);
                    
                    // Get the leaderboard container
                    const container = document.querySelector('.leaderboard-grid');
                    if (!container) return;
                    
                    // Keep the title
                    const title = container.querySelector('h2') || document.createElement('h2');
                    title.innerHTML = `🌟 Today's Leaders (${leaderboard.filter(e => e.is_clocked_in).length} Active) 🌟`;
                    
                    // Clear and rebuild
                    container.innerHTML = '';
                    container.appendChild(title);
                    
                    // Show top 5 employees
                    console.log("Displaying", leaderboard.length, "employees:", leaderboard.map(e => e.name));
                    leaderboard.forEach((employee, index) => {
                        const card = document.createElement('div');
                        card.className = 'employee-card';
                        card.style.animationDelay = `${index * 0.1}s`;
                        
                        // Parse time worked correctly
                        const timeWorked = employee.time_worked || '0:00';
                        const statusEmoji = employee.is_clocked_in ? '🟢' : '🔴';
                        const statusText = employee.is_clocked_in ? 'Working' : 'Off';
                        
                        card.innerHTML = `
                            <div class="rank">${index + 1}</div>
                            <div class="employee-info">
                                <div class="employee-avatar">${employee.department_icon || '👤'}</div>
                                <div>
                                    <div class="employee-name">${employee.name}</div>
                                    <div class="employee-stats">
                                        <span>${statusEmoji} ${employee.items_today || 0} items</span>
                                        <span>⏱️ ${timeWorked}</span>
                                        <span>⚡ ${employee.items_per_minute || 0}/min</span>
                                        <span>${statusText}</span>
                                    </div>
                                    <div class="employee-activities" style="font-size: 0.8em; opacity: 0.8;">
                                        ${employee.activity_display || ''}
                                    </div>
                                </div>
                            </div>
                            <div class="employee-score">${Math.round(employee.score || 0)}</div>
                        `;
                        
                        container.appendChild(card);
                    });
                    
                } catch (error) {
                    console.error('Error loading leaderboard:', error);
                }
            }
        };
        
        // Replace the static updateLeaderboard function
        // function updateLeaderboard_OLD() {
            shopFloorUpdater.loadLeaderboard();
        }
        
        // Initialize when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => shopFloorUpdater.init());
        } else {
            shopFloorUpdater.init();
        }
    </script>

</body>
</html>